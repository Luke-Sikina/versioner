DROP TABLE IF EXISTS `codebase`;
DROP TABLE IF EXISTS `vpn`;
DROP TABLE IF EXISTS `environment`;
DROP TABLE IF EXISTS `environment_codebase_pair`;


CREATE TABLE `codebase` (
    CODEBASE_ID INT(11) NOT NULL AUTO_INCREMENT,
    NAME VARCHAR(512) NOT NULL,
    URL VARCHAR(2000) NOT NULL,
    PRIMARY KEY (`CODEBASE_ID`),
    UNIQUE(URL)
);

CREATE TABLE `vpn` (
    VPN_ID INT(11) NOT NULL AUTO_INCREMENT,
    NAME VARCHAR(512) NOT NULL,
    URL VARCHAR(2000) NOT NULL,
    ORGANIZATION VARCHAR(512) NOT NULL,
    PRIMARY KEY (`VPN_ID`)
);

CREATE TABLE `environment` (
    ENVIRONMENT_ID INT(11) NOT NULL AUTO_INCREMENT,
    NAME VARCHAR(512) NOT NULL,
    URL VARCHAR(2000) NOT NULL,
    VPN_ID INT(11) NOT NULL,
    PRIMARY KEY (`ENVIRONMENT_ID`),
    FOREIGN KEY (`VPN_ID`) REFERENCES `vpn` (`VPN_ID`),
    UNIQUE(DOMAIN_ID, PATH_HASH),
    UNIQUE(NAME)
);

CREATE TABLE `environment_codebase_pair` (
    ENVIRONMENT_CODEBASE_PAIR_ID INT(11) NOT NULL AUTO_INCREMENT,
    ENVIRONMENT_ID INT(11) NOT NULL,
    CODEBASE_ID INT(11) NOT NULL,
    PRIMARY KEY (`ENVIRONMENT_CODEBASE_PAIR_ID`),
    FOREIGN KEY (`ENVIRONMENT_ID`) REFERENCES `environment` (`ENVIRONMENT_ID`),
    FOREIGN KEY (`CODEBASE_ID`) REFERENCES `codebase` (`CODEBASE_ID`),
    UNIQUE(ENVIRONMENT_ID, CODEBASE_ID)
);
